dplyr::filter(!is.na(hladr_mfi))
data_raw_infant_bcg_no %>%
dplyr::bind_rows(
data_raw_infant_bcg
) %>%
dplyr::mutate(
bcg = tolower(bcg),
pop = long_to_short_pop[pop]
) %>%
dplyr::select(-age)
}) %>%
tibble::as_tibble()
# Chunk 7
datautils::view_cols(
data_tidy_hladr_infant_orig
)
# Chunk 8
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM",
"gd T cells",
"CD4 T cells"
)
path_data_raw <- file.path(
dir_data_raw,
"Fig.4 Activation profile adults.xlsx"
)
data_tidy_hladr_adult_orig <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet,
age = "adult",
row = 1:(dplyr::n())
)  %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
)
data_raw %>%
tidyr::pivot_longer(
-c(pid, pop, row, age),
names_to = "days",
values_to = "hladr_mfi"
) %>%
dplyr::select(
pid, age, pop, days, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop]
) %>%
dplyr::mutate(
days = as.integer(days)
) %>%
dplyr::select(-age)
}) %>%
tibble::as_tibble()
# Chunk 9
datautils::view_cols(
data_tidy_hladr_adult_orig
)
# Chunk 10
path_data_raw <- file.path(
dir_data_raw,
"Copy of delayed BCG samples for Anele_.xlsx"
)
data_tidy_clin_infant_bcg_orig <- readxl::read_xlsx(
path_data_raw,
skip = 4,
n_max = 25
) %>%
dplyr::mutate(bcg = "no bcg") %>%
dplyr::mutate(age = "infant") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid_r = paste0(age, "_", row)) %>%
dplyr::select(-c(row, age))
data_tidy_clin_infant_bcg_no_orig<- readxl::read_xlsx(
path_data_raw,
skip = 32,
n_max = 25,
col_names = FALSE
) %>%
dplyr::mutate(bcg = "bcg") %>%
dplyr::mutate(age = "infant") %>%
dplyr::mutate(row = seq_len(dplyr::n()) + 25) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid_r = paste0(age, "_", row)) %>%
dplyr::select(-c(row, age))
colnames(data_tidy_clin_infant_bcg_no_orig) <- colnames(data_tidy_clin_infant_bcg_orig)
data_tidy_clin_infant_orig <- data_tidy_clin_infant_bcg_orig %>%
dplyr::bind_rows(data_tidy_clin_infant_bcg_no_orig)
data_tidy_clin_infant_orig <- data_tidy_clin_infant_orig %>%
dplyr::select(pid_r, PID, BabyEthnicGroup, GestationalAgeWeeks, BirthWeight:BirthHeadCirc, bcg) %>%
dplyr::rename(pid_sheet = PID,
ethnicity = BabyEthnicGroup,
gest_age = GestationalAgeWeeks,
weight = BirthWeight,
length = BirthLength,
head_circ = BirthHeadCirc)
data_tidy_clin_infant_orig <- data_tidy_clin_infant_orig %>%
dplyr::mutate(
pid_sheet = as.character(pid_sheet)
) %>%
dplyr::mutate(
age = "infant"
) %>%
dplyr::rename(pid = pid_r) %>%
dplyr::select(-bcg) %>%
dplyr::select(-pid_sheet)
# Chunk 11
datautils::view_cols(
data_tidy_clin_infant_orig
)
# Chunk 12
path_data_raw <- file.path(
dir_data_raw,
"TBRU samples for Anele .xlsx"
)
data_label_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "TBRU samples"
) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row, age)) %>%
dplyr::select(pid, `Sample ID`)
sheet_to_r_pid_adult_orig <- setNames(
data_label_clin_adult_orig$pid,
data_label_clin_adult_orig$`Sample ID`
)
data_tidy_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row)) %>%
dplyr::select(pid, age, age_in_years, sex,
race, hgbval, bcgscar, height,
weight, PPDmm) %>%
dplyr::rename(ppd = PPDmm)
data_tidy_clin_adult <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = as.character(sex),
race = as.character(race),
bcgscar = as.character(bcgscar))
num_to_chr_sex_adult <- c("1" = "male", "2" = "female")
num_to_chr_race_adult <- c("3" = "non_african", "1" = "african")
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = num_to_chr_sex_adult[sex],
race = num_to_chr_race_adult[race])
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::select(-bcgscar)
datautils::view_cols(
data_tidy_clin_adult_orig
)
path_data_raw <- file.path(
dir_data_raw,
"TBRU samples for Anele .xlsx"
)
data_label_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "TBRU samples"
) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row, age)) %>%
dplyr::select(pid, `Sample ID`)
sheet_to_r_pid_adult_orig <- setNames(
data_label_clin_adult_orig$pid,
data_label_clin_adult_orig$`Sample ID`
)
readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row))
readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row))
readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row))
readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
)
path_data_raw <- file.path(
dir_data_raw,
"TBRU samples for Anele .xlsx"
)
data_label_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "TBRU samples"
) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row, age)) %>%
dplyr::select(pid, `Sample ID`)
sheet_to_r_pid_adult_orig <- setNames(
data_label_clin_adult_orig$pid,
data_label_clin_adult_orig$`Sample ID`
)
data_tidy_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row)) %>%
dplyr::select(pid, age, age_in_years, sex,
race, hgbval, bcgscar, height,
weight, PPDmm) %>%
dplyr::rename(ppd = PPDmm)
data_tidy_clin_adult <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = as.character(sex),
race = as.character(race),
bcgscar = as.character(bcgscar))
num_to_chr_sex_adult <- c("1" = "male", "2" = "female")
num_to_chr_race_adult <- c("3" = "non_african", "1" = "african")
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = num_to_chr_sex_adult[sex],
race = num_to_chr_race_adult[race])
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::select(-bcgscar)
datautils::view_cols(
data_tidy_clin_adult_orig
)
data_tidy_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row)) %>%
dplyr::select(pid, age, age_in_years, sex,
race, hgbval, bcgscar, height,
weight, PPDmm) %>%
dplyr::rename(ppd = PPDmm)
data_tidy_clin_adult <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = as.character(sex),
race = as.character(race),
bcgscar = as.character(bcgscar))
data_tidy_clin_adult$race %>% unique()
data_tidy_clin_adult <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = as.character(sex),
race = as.character(race),
bcgscar = as.character(bcgscar))
num_to_chr_sex_adult <- c("1" = "male", "2" = "female")
num_to_chr_race_adult <- c("3" = "non_african", "1" = "african")
data_tidy_clin_adult_orig$race %>% unique()
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = num_to_chr_sex_adult[sex],
race = num_to_chr_race_adult[race])
data_tidy_clin_adult_orig$race %>% unique()
path_data_raw <- file.path(
dir_data_raw,
"TBRU samples for Anele .xlsx"
)
data_label_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "TBRU samples"
) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row, age)) %>%
dplyr::select(pid, `Sample ID`)
sheet_to_r_pid_adult_orig <- setNames(
data_label_clin_adult_orig$pid,
data_label_clin_adult_orig$`Sample ID`
)
data_tidy_clin_adult_orig <- readxl::read_xlsx(
path_data_raw,
skip = 1,
n_max = 25,
sheet = "Acquired TBRU samples"
) %>%
dplyr::rename(age_in_years = age) %>%
dplyr::mutate(age = "adult") %>%
dplyr::mutate(row = seq_len(dplyr::n())) %>%
dplyr::mutate(row = ifelse(
str_length(row) == 1,
paste0("0", row),
row)) %>%
dplyr::mutate(pid = paste0(age, "_", row)) %>%
dplyr::select(-c(row)) %>%
dplyr::select(pid, age, age_in_years, sex,
race, hgbval, bcgscar, height,
weight, PPDmm) %>%
dplyr::rename(ppd = PPDmm)
data_tidy_clin_adult <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == 2, 3, race)) %>%
dplyr::mutate(sex = as.character(sex),
race = as.character(race),
bcgscar = as.character(bcgscar))
num_to_chr_sex_adult <- c("1" = "male", "2" = "female")
num_to_chr_race_adult <- c("3" = "non_african", "1" = "african")
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::mutate(race = ifelse(race == "2", "3", race)) %>%
dplyr::mutate(sex = num_to_chr_sex_adult[sex],
race = num_to_chr_race_adult[race])
data_tidy_clin_adult_orig <- data_tidy_clin_adult_orig %>%
dplyr::select(-bcgscar)
datautils::view_cols(
data_tidy_clin_adult_orig
)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"gd T cells",
"CD4 T cells"
)
path_data_raw <- file.path(
dir_data_raw,
"2021_09_16,Gela,email-Figure 5- Memory profile.xlsx"
)
data_tidy_mem <- purrr::map_df(sheet_vec, function(sheet) {
data_raw_grp <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet,
n_max = 0
)
data_raw_pop <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet,
n_max = 1,
skip = 0
)
info_tbl <- data_raw_pop %>%
dplyr::mutate(id = 1) %>%
tidyr::pivot_longer(
-id,
names_to = "grp",
values_to = "pop"
) %>%
dplyr::select(-id) %>%
dplyr::filter(!grepl("^\\.\\..\\d+$", grp)) %>%
dplyr::mutate(grp = stringr::str_remove_all(grp, "\\.+\\d*$"))
pop_vec <- info_tbl$pop[!is.na(info_tbl$pop)]
info_tbl[seq(2, nrow(info_tbl), by = 3), "pop"] <- pop_vec
info_tbl[seq(3, nrow(info_tbl), by = 3), "pop"] <- pop_vec
cn_vec <- paste0(info_tbl$grp, "_", info_tbl$pop)
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet,
col_names = FALSE,
skip = 2,
n_max = 25
)
data_raw <- data_raw[
, purrr::map_lgl(data_raw, function(x) !all(is.na(x)))
]
colnames(data_raw) <- cn_vec
data_raw %>%
dplyr::mutate(
row = seq_len(dplyr::n())
) %>%
tidyr::pivot_longer(
- row,
names_to = "grp",
values_to = "freq"
) %>%
tidyr::separate(
col = "grp",
into = c("grp_2", "pop"),
sep = "_"
) %>%
dplyr::mutate(
age = ifelse(grp_2 == "Adult", "adult", "infant"),
bcg = ifelse(grp_2 == "Adult", "day_365", tolower(grp_2))
) %>%
dplyr::select(-grp_2) %>%
dplyr::group_by(age, bcg) %>%
dplyr::mutate(
row = 1:25 + ifelse(bcg == "bcg", 25, 0),
row = ifelse(age == "adult", 1:25, row),
row = as.character(row),
row = ifelse(
stringr::str_length(row) == 1,
paste0("0", row),
row
),
pid = paste0(age, "_", row)
) %>%
dplyr::ungroup() %>%
dplyr::rename(
pop_sub = pop
) %>%
dplyr::mutate(
pop = long_to_short_pop[sheet]
) %>%
dplyr::select(pid, age, bcg, pop, pop_sub, freq)
}) %>%
tibble::as_tibble()
datautils::view_cols(
data_tidy_mem
)
data_tidy_mem %>% dplyr::filter(is.na(freq))
datautils::view_cols(
data_tidy_hladr_infant_orig
)
