dplyr::mutate(
days = as.integer(days)
)
})
usethis::use_data(data_tidy_hladr_adult)
usethis::use_data(data_tidy_hladr_adult)
library(DataTidyGelaDURT)
DataTidyGelaDURT::data_tidy_hladr_adult
library(DataTidyGelaDURT)
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(stringr)
dir_data_raw <- file.path(
dirname(here::here()),
"DataRawGelaDURT"
)
long_to_short_pop <- c(
"MAIT cells" = "mait",
"NKT cells" = "nkt",
"CD1b-GMM" = "cd1b",
"GEM T cells" = "gem",
"gd T cells" = "gd",
"CD4 Tcells" = "cd4",
"CD4+ Tcells" = "cd4",
"IFNg+ CD4 T cells" = "cd4_ifng"
)
?readr::read_xlsx
?readr::read_xlsx
?readxl::read_xlsx
library(magrittr)
library(stringr)
library(magrittr)
library(stringr)
dir_data_raw <- file.path(
dirname(here::here()),
"DataRawGelaDURT"
)
long_to_short_pop <- c(
"MAIT cells" = "mait",
"NKT cells" = "nkt",
"CD1b-GMM" = "cd1b",
"GEM T cells" = "gem",
"gd T cells" = "gd",
"CD4 Tcells" = "cd4",
"CD4+ Tcells" = "cd4",
"IFNg+ CD4 T cells" = "cd4_ifng"
)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM",
"GEM T cells",
"gd T cells",
"CD4 Tcells",
"IFNg+ CD4 T cells"
)
dir_data_raw <- file.path(
dirname(here::here()),
"DataRawGelaDURT"
)
path_data_raw <- file.path(
dir_data_raw,
"Fig. 2 Frequencies.xlsx"
)
data_tidy_freq <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet
) %>%
dplyr::mutate(
row = 1:(dplyr::n())
) %>%
tidyr::pivot_longer(
-c(pop, row),
names_to = "bcg",
values_to = "freq"
) %>%
dplyr::mutate(
age = ifelse(bcg %in% c("Before", "After"),
"adult", "infant")
) %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
) %>%
dplyr::select(
pid, age, bcg, pop, freq
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop]
) %>%
dplyr::mutate(
bcg = tolower(bcg)
)
}) %>%
tibble::as_tibble()
data_tidy_freq
datautils::view_cols(
data_tidy_freq
)
usethis::use_data(data_tidy_freq,
overwrite = TRUE)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM",
"gd T cells",
"CD4+ Tcells"
)[c(2, 3, 4, 5, 1)]
path_data_raw <- file.path(
dir_data_raw,
"Fig. 3 Activation profile_infants.xlsx"
)
data_tidy_hladr_infant <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet
)
data_raw <- data_raw[,c("pop", "No BCG", "BCG")]
data_raw %>%
dplyr::mutate(
row = 1:(dplyr::n())
) %>%
tidyr::pivot_longer(
-c(pop, row),
names_to = "bcg",
values_to = "hladr_mfi"
) %>%
dplyr::mutate(
age = ifelse(bcg %in% c("Before", "After"),
"adult", "infant")
) %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
) %>%
dplyr::select(
pid, age, bcg, pop, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop],
bcg = tolower(bcg)
)
}) %>%
tibble::as_tibble()
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM T cells",
"gd T cells",
"CD4+ Tcells"
)[c(2, 3, 4, 5, 1)]
path_data_raw <- file.path(
dir_data_raw,
"Fig. 3 Activation profile_infants.xlsx"
)
data_tidy_hladr_infant <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet
)
data_raw <- data_raw[,c("pop", "No BCG", "BCG")]
data_raw %>%
dplyr::mutate(
row = 1:(dplyr::n())
) %>%
tidyr::pivot_longer(
-c(pop, row),
names_to = "bcg",
values_to = "hladr_mfi"
) %>%
dplyr::mutate(
age = ifelse(bcg %in% c("Before", "After"),
"adult", "infant")
) %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
) %>%
dplyr::select(
pid, age, bcg, pop, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop],
bcg = tolower(bcg)
)
}) %>%
tibble::as_tibble()
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM T cells",
"gd T cells",
"CD4+ T cells"
)[c(2, 3, 4, 5, 1)]
path_data_raw <- file.path(
dir_data_raw,
"Fig. 3 Activation profile_infants.xlsx"
)
data_tidy_hladr_infant <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet
)
data_raw <- data_raw[,c("pop", "No BCG", "BCG")]
data_raw %>%
dplyr::mutate(
row = 1:(dplyr::n())
) %>%
tidyr::pivot_longer(
-c(pop, row),
names_to = "bcg",
values_to = "hladr_mfi"
) %>%
dplyr::mutate(
age = ifelse(bcg %in% c("Before", "After"),
"adult", "infant")
) %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
) %>%
dplyr::select(
pid, age, bcg, pop, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop],
bcg = tolower(bcg)
)
}) %>%
tibble::as_tibble()
dir_data_raw <- file.path(
dirname(here::here()),
"DataRawGelaDURT"
)
long_to_short_pop <- c(
"MAIT cells" = "mait",
"NKT cells" = "nkt",
"CD1b-GMM" = "cd1b",
"CD1b-GMM T cells" = "cd1b",
"GEM T cells" = "gem",
"gd T cells" = "gd",
"CD4 Tcells" = "cd4",
"CD4+ T cells" = "cd4",
"IFNg+ CD4 T cells" = "cd4_ifng"
)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM",
"GEM T cells",
"gd T cells",
"CD4 Tcells",
"IFNg+ CD4 T cells"
)
dir_data_raw <- file.path(
dirname(here::here()),
"DataRawGelaDURT"
)
path_data_raw <- file.path(
dir_data_raw,
"Fig. 2 Frequencies.xlsx"
)
data_tidy_freq <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet
) %>%
dplyr::mutate(
row = 1:(dplyr::n())
) %>%
tidyr::pivot_longer(
-c(pop, row),
names_to = "bcg",
values_to = "freq"
) %>%
dplyr::mutate(
age = ifelse(bcg %in% c("Before", "After"),
"adult", "infant")
) %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
) %>%
dplyr::select(
pid, age, bcg, pop, freq
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop]
) %>%
dplyr::mutate(
bcg = tolower(bcg)
)
}) %>%
tibble::as_tibble()
datautils::view_cols(
data_tidy_freq
)
usethis::use_data(data_tidy_freq,
overwrite = TRUE)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM T cells",
"gd T cells",
"CD4+ T cells"
)[c(2, 3, 4, 5, 1)]
path_data_raw <- file.path(
dir_data_raw,
"Fig. 3 Activation profile_infants.xlsx"
)
data_tidy_hladr_infant <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet
)
data_raw <- data_raw[,c("pop", "No BCG", "BCG")]
data_raw %>%
dplyr::mutate(
row = 1:(dplyr::n())
) %>%
tidyr::pivot_longer(
-c(pop, row),
names_to = "bcg",
values_to = "hladr_mfi"
) %>%
dplyr::mutate(
age = ifelse(bcg %in% c("Before", "After"),
"adult", "infant")
) %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
) %>%
dplyr::select(
pid, age, bcg, pop, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop],
bcg = tolower(bcg)
)
}) %>%
tibble::as_tibble()
datautils::view_cols(
data_tidy_hladr_infant
)
usethis::use_data(data_tidy_hladr_infant,
overwrite = TRUE)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM",
"gd T cells",
"CD4 Tcells"
)
path_data_raw <- file.path(
dir_data_raw,
"Fig.4 Activation profile adults.xlsx"
)
data_tidy_hladr_adult <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet,
age = "adult",
row = 1:(dplyr::n())
)  %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
)
data_raw %>%
tidyr::pivot_longer(
-c(pid, pop, row, age),
names_to = "days",
values_to = "hladr_mfi"
) %>%
dplyr::select(
pid, age, pop, days, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop]
) %>%
dplyr::mutate(
days = as.integer(days)
)
}) %>%
tibble::as_tibble()
dir_data_raw <- file.path(
dirname(here::here()),
"DataRawGelaDURT"
)
long_to_short_pop <- c(
"MAIT cells" = "mait",
"NKT cells" = "nkt",
"CD1b-GMM" = "cd1b",
"CD1b-GMM T cells" = "cd1b",
"GEM T cells" = "gem",
"gd T cells" = "gd",
"CD4 Tcells" = "cd4",
"CD4 T cells" = "cd4",
"CD4+ T cells" = "cd4",
"IFNg+ CD4 T cells" = "cd4_ifng"
)
sheet_vec <- c(
"MAIT cells",
"NKT cells",
"CD1b-GMM",
"gd T cells",
"CD4 T cells"
)
path_data_raw <- file.path(
dir_data_raw,
"Fig.4 Activation profile adults.xlsx"
)
data_tidy_hladr_adult <- purrr::map_df(sheet_vec, function(sheet) {
data_raw <- readxl::read_xlsx(
file.path(
path_data_raw
),
sheet = sheet
) %>%
dplyr::mutate(
pop = sheet,
age = "adult",
row = 1:(dplyr::n())
)  %>%
dplyr::mutate(
pid = paste0(
age,
"_",
ifelse(str_length(row) == 1,
paste0("0", row), row))
)
data_raw %>%
tidyr::pivot_longer(
-c(pid, pop, row, age),
names_to = "days",
values_to = "hladr_mfi"
) %>%
dplyr::select(
pid, age, pop, days, hladr_mfi
) %>%
dplyr::mutate(
pop = long_to_short_pop[pop]
) %>%
dplyr::mutate(
days = as.integer(days)
)
}) %>%
tibble::as_tibble()
datautils::view_cols(
data_tidy_hladr_adult
)
usethis::use_data(data_tidy_hladr_adult,
overwrite = TRUE)
library(DataTidyGelaDURT)
